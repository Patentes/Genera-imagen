<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Generador de Imagen para Impresi√≥n</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f6f6f6;
      text-align: center;
      padding: 50px;
    }
    input, button, select {
      margin: 10px;
    }
    canvas {
      border: 1px solid #ccc;
      margin-top: 10px;
    }
    .hidden {
      display: none;
    }
    #historialTabla td, #historialTabla th {
      padding: 8px;
      border: 1px solid #ddd;
    }
    #historialTabla {
      margin: 20px auto;
      border-collapse: collapse;
    }
    #descargarBtn {
      display: inline-block;
      margin-top: 10px;
      padding: 10px 20px;
      background-color: #4CAF50;
      color: white;
      text-decoration: none;
      border-radius: 5px;
      font-weight: bold;
    }
    #descargarBtn:hover {
      background-color: #45a049;
    }
  </style>
</head>
<body>
  <div id="login">
    <h2>Iniciar Sesi√≥n</h2>
    <input type="text" id="user" placeholder="Usuario"><br>
    <input type="password" id="pass" placeholder="Contrase√±a"><br>
    <button onclick="login()">Entrar</button>
  </div>

  <div id="app" class="hidden">
    <h1>Generador de Imagen para Impresi√≥n</h1>
    <p>Bienvenido, <span id="nombreUsuario"></span></p>
    <input type="text" id="texto" placeholder="Escribe aqu√≠ letras o n√∫mero">
    <br>
    Tama√±o del texto: <strong id="tamanioTextoLabel">24</strong> px
    <br>
    <input type="range" id="tamanioTexto" min="10" max="100" value="24">
    <br>
    <button onclick="generarImagen()">Generar Imagen</button>
    <button onclick="revertirImagen()" id="revertirBtn" class="hidden">Revertir Imagen</button>
    <br>
    <canvas id="canvas" width="600" height="300"></canvas>
    <br>
    <a id="descargarBtn" download="patente.png" class="hidden">Descargar Imagen</a>
  </div>

  <div id="historial" class="hidden">
    <h2>Historial de impresiones</h2>
    <table id="historialTabla"></table>
  </div>

  <script>
    const users = {
      "admin": "1234",
      "Freddy": "Fred",
      "Milton": "Mork",
      "Vicente": "vice123"
    };

    let usuarioActual = null;
    const historial = [];
    let imagenGenerada = null;
    let textoActual = "";

    function login() {
      const u = document.getElementById('user').value;
      const p = document.getElementById('pass').value;
      if (users[u] && users[u] === p) {
        usuarioActual = u;
        document.getElementById('login').classList.add('hidden');
        document.getElementById('app').classList.remove('hidden');
        document.getElementById('nombreUsuario').textContent = usuarioActual;
        if (usuarioActual === 'admin') {
          document.getElementById('historial').classList.remove('hidden');
          renderHistorial();
        } else {
          document.getElementById('historial').classList.add('hidden');
        }
      } else {
        alert('Usuario o contrase√±a incorrectos');
      }
    }

    document.getElementById('tamanioTexto').addEventListener('input', e => {
      document.getElementById('tamanioTextoLabel').textContent = e.target.value;
    });

    function generarImagen() {
      const texto = document.getElementById('texto').value;
      const tamanio = document.getElementById('tamanioTexto').value;
      textoActual = texto;

      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d');

      // Mejor calidad (escalado)
      const scale = 3;
      const width = canvas.width;
      const height = canvas.height;

      canvas.width = width * scale;
      canvas.height = height * scale;
      canvas.style.width = width + "px";
      canvas.style.height = height + "px";
      ctx.scale(scale, scale);

      // Dibujar texto
      ctx.clearRect(0, 0, width, height);
      ctx.font = `${tamanio}px Arial`;
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillStyle = "black";
      ctx.fillText(texto, width / 2, height / 2);

      imagenGenerada = canvas.toDataURL();

      // Guardar en historial
      const ahora = new Date();
      historial.push({
        usuario: usuarioActual,
        texto,
        fecha: ahora.toLocaleDateString(),
        hora: ahora.toLocaleTimeString()
      });

      if (usuarioActual === 'admin') renderHistorial();

      // Mostrar bot√≥n de descargar
      const enlace = document.getElementById('descargarBtn');
      enlace.classList.remove('hidden');
      enlace.textContent = "Descargar Imagen";

      // Al hacer clic en descargar, enviar notificaci√≥n a Discord
      enlace.onclick = function () {
        enlace.href = canvas.toDataURL();

        const ahora = new Date();
        const webhookUrl = "https://discord.com/api/webhooks/1364802693012521000/MBUF565wKk7lV_xJgy5e4JqNCOI-PYOCUm1E3VxuJt9DWQ8StrXVrQGK8IOmIa0tmfz9"; // üëâ REEMPLAZA CON TU WEBHOOK

        const mensaje = {
          content: `üñ®Ô∏è Usuario **${usuarioActual}** descarg√≥ una imagen con el texto: **${textoActual}** a las ${ahora.toLocaleTimeString()}`
        };

        fetch(webhookUrl, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(mensaje)
        });
      };

      document.getElementById('revertirBtn').classList.remove('hidden');
    }

    function revertirImagen() {
      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d');

      if (imagenGenerada) {
        const img = new Image();
        img.src = imagenGenerada;
        img.onload = function () {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.save();
          ctx.scale(-1, 1);
          ctx.drawImage(img, -canvas.width, 0);
          ctx.restore();
        };
      }

      document.getElementById('revertirBtn').classList.add('hidden');
    }

    function renderHistorial() {
      const tabla = document.getElementById('historialTabla');
      tabla.innerHTML = '<tr><th>Usuario</th><th>Texto</th><th>Fecha</th><th>Hora</th></tr>';
      historial.forEach(item => {
        const fila = `<tr><td>${item.usuario}</td><td>${item.texto}</td><td>${item.fecha}</td><td>${item.hora}</td></tr>`;
        tabla.innerHTML += fila;
      });
    }
  </script>
</body>
</html>

